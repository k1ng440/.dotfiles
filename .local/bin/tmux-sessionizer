#!/usr/bin/env bash

if [[ $# -eq 1 ]]; then
    selected=$1
else
    selected=$(find \
        "$HOME"  \
        "$HOME/projects" \
        "$HOME/code" \
        -mindepth 1 -maxdepth 1 -type d | fzf)
        # "$XDG_CONFIG_HOME" \
        # /d/code \
        # /d/code/os \
fi
if [[ -z $selected ]]; then
    exit 0
fi

selected_name=$(basename "$selected" | tr . _)
# tmux_running=$(pgrep tmux)

tmux has-session -t "$selected_name" 2>/dev/null
if [ $? != 0 ]; then
  tmux new-session -ds "$selected_name" -c "$selected"
    # tmux source-file .tmux.conf
    # tmux send-keys -t $selected_name "nv" Enter
fi

if [[ -z $TMUX ]]; then
    tmux attach -t "$selected_name"
else
    tmux switch-client -t "$selected_name"
fi
